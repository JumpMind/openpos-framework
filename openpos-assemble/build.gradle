buildscript {
    repositories {
        maven { url "http://maven.jumpmind.com/repo" }
        jcenter()
        mavenCentral()
    }
    dependencies {
        classpath "com.moowork.gradle:gradle-node-plugin:1.3.1"
    }
}

apply from: '../openpos-gradle/src/main/resources/java.gradle'
apply from: '../openpos-gradle/src/main/resources/release.gradle'

task generateSourceArtifact(type: Copy) {
    doFirst {
        println "Rebuilding build/openpos-server-core-lib"
        delete 'build/openpos-server-core-lib'
    }
    into('build/openpos-server-core-lib')
    from('../') {
        exclude '**/target', '**/build', '**/bin', '**/src/test/java', 'openpos.code-workspace',
                'openpos-client-seed','openpos-cordova', 'openpos-test-module', 'openpos-cordova-log-plugin',
                'node', 'azure-pipelines*.yml', '**/*.iml', '**/.project', '**/.classpath', '**/.gitignore', 
                '**/.idea', '**/.settings', '**/.gradle'
    }
    from('../') {
        include '**/openpos-version.properties'
                filter(org.apache.tools.ant.filters.ReplaceTokens, tokens: [
                    'version': version,
                    'buildTime': new java.text.SimpleDateFormat('yyyy-MM-dd HH:mm:ss').format(new java.util.Date()),
                    'gitBranch' : gitBranch,
                    'gitHash' : gitHash,
                    'buildNumber' : buildNumber,
                    'buildName' : buildName
                ])
    }
}
